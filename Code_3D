# Load necessary libraries
library(dplyr)
library(ggplot2)
library(Seurat)  # Assuming you're using Seurat for DimPlot

# Access and modify the metadata of the Seurat object
metadata <- RealBatchCorrectedBacherSeurat@meta.data

# Create the 'celltypeNEW' column, modifying specific categories
metadata$celltypeNEW <- metadata$new_cluster_names
metadata$celltypeNEW[metadata$celltypeNEW %in% c("Central memory")] <- "Naïve"

# Create the 'cellTypeSimple' column with specific mappings
metadata$cellTypeSimple <- dplyr::case_when(
    metadata$new_cluster_names == "Central memory" ~ "Naïve",
    metadata$new_cluster_names == "Cycling" ~ "Other",
    metadata$new_cluster_names == "Cytotoxic / Th1" ~ "Effector",
    metadata$new_cluster_names == "Tfh-like" ~ "Effector",
    metadata$new_cluster_names == "Transitional memory" ~ "Other",
    metadata$new_cluster_names == "Type-I IFN signature" ~ "Other",
    TRUE ~ metadata$new_cluster_names  # Keep other values unchanged
)

# Add the modified metadata back to the Seurat object
RealBatchCorrectedBacherSeurat@meta.data <- metadata

# Generate the DimPlot and assign it to a variable
p_dimplot <- DimPlot(
    RealBatchCorrectedBacherSeurat, 
    group.by = "celltypeNEW", 
    #cellTypeSimple can also be used
    raster = FALSE
) + 
    ggtitle("Cell Type") +
    theme(
        plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Center and style the title
        axis.title = element_text(size = 14),  # Style axis titles if present
        axis.text = element_text(size = 12)  # Style axis text if present
    )

# Display the plot (optional)
print(p_dimplot)

# Save the DimPlot to a file
ggsave(
    filename = "cell_type_dimplot_graphfinal.png",  # Specify the desired filename
    plot = p_dimplot,  # Pass the plot object
    width = 7,  # Set the width of the plot
    height = 5,  # Set the height of the plot
    units = "in",  # Units for width and height ("in", "cm", "mm")
    dpi = 800  # Resolution of the plot
)
